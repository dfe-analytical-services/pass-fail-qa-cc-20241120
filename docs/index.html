<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-01c78b5cd655e4cd89133cf59d535862.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.36">

  <meta name="author" content="Cam Race">
  <title>Test that! No literally, testthat…</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-bbe7401fe57d4b791b917637bb662036.css">
  <link rel="stylesheet" href="theme.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Test that! No literally, testthat…</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Cam Race 
</div>
</div>
</div>

</section>
<section id="what-i-hope-to-cover" class="slide level2">
<h2>What I hope to cover</h2>
<ul>
<li class="fragment"><p>A quick overview of what is possible when using testthat for quick pass / fail checks in</p>
<ul>
<li class="fragment"><p>R code (e.g.&nbsp;in analysis or pipelines)</p></li>
<li class="fragment"><p>R Shiny applications</p></li>
<li class="fragment"><p>R packages</p></li>
</ul></li>
<li class="fragment"><p>Show a number of examples of testing with R code that</p>
<ul>
<li class="fragment"><p>R users can steal, adapt, and reuse</p></li>
<li class="fragment"><p>Non R users or senior managers can use as inspiration when directing their teams quality assurance (QA)</p></li>
<li class="fragment"><p>Show some starting points for you to get going with</p></li>
</ul></li>
</ul>
</section>
<section id="disclaimer-i-am-not-going-to" class="slide level2">
<h2>Disclaimer: I am not going to</h2>
<ul>
<li class="fragment"><p>Show you through one specific project</p>
<ul>
<li class="fragment">Instead, I’ll compensate by scatter-gunning some examples in the hope they provide useful inspiration</li>
</ul></li>
<li class="fragment"><p>Teach you to QA</p>
<ul>
<li class="fragment">There are many aspects of QA that require analytical skills, experience and insight to assess and make judgement calls, you can’t do all QA with just pass / fail tests</li>
<li class="fragment">Lots of QA is specific to the analysis you’re doing</li>
</ul></li>
<li class="fragment"><p>Teach you how to build R Shiny apps or R packages</p>
<ul>
<li class="fragment"><p>I will skim over some of the details of these to focus on the testing</p></li>
<li class="fragment"><p>Both have had multiple <a href="https://educationgovuk.sharepoint.com/sites/sarpi/g/AC/Coffee%20and%20Coding.aspx?xsdata=MDV8MDJ8fGVmYmNjMzE0N2ExNjRhNTg4NTQ1MDhkZDA5NGQzY2RifGZhZDI3N2M5YzYwYTRkYTFiNWYzYjNiOGIzNGE4MmY5fDB8MHw2Mzg2NzY5NDk0OTQ2Mjk3MDF8VW5rbm93bnxWR1ZoYlhOVFpXTjFjbWwwZVZObGNuWnBZMlY4ZXlKV0lqb2lNQzR3TGpBd01EQWlMQ0pRSWpvaVYybHVNeklpTENKQlRpSTZJazkwYUdWeUlpd2lWMVFpT2pFeGZRPT18MXxMMk5vWVhSekx6RTVPakF3T1RGa05EVmxMVEl6TTJFdE5EUTFNeTFoWkdWaUxUUTVObVF5WlRBd09XWmpZMTh6WWpKaU1qSTNNeTFoWmpJM0xUUTVZMk10WVRFMk15MHpaakJrWlRGaU1ESXlaV1pBZFc1eExtZGliQzV6Y0dGalpYTXZiV1Z6YzJGblpYTXZNVGN6TWpBNU9ERTBPRE14TXc9PXw3OWI5ZTBkOGY5YTc0OWVmMjUxYzA4ZGQwOTRkM2NkOXw0ZGQzYzYyMGVjMTc0YTZlYWVmMDY0NDhjZTNmNmM1ZA%3D%3D&amp;sdata=U2t3UjEwVHBYY081NkZHMmk2ZzFEUlZ6SGtVUjdtb2NWSlZ0YmJtR2NqWT0%3D&amp;ovuser=fad277c9-c60a-4da1-b5f3-b3b8b34a82f9%2CCameron.RACE%40EDUCATION.GOV.UK&amp;OR=Teams-HL&amp;CT=1732098230181&amp;clickparams=eyJBcHBOYW1lIjoiVGVhbXMtRGVza3RvcCIsIkFwcFZlcnNpb24iOiI0OS8yNDEwMjAwMTMxOCIsIkhhc0ZlZGVyYXRlZFVzZXIiOmZhbHNlfQ%3D%3D">coffee and coding sessions</a> in their own right - have a watch back of them</p></li>
<li class="fragment"><p>Have a look at the <a href="https://dfe-analytical-services.github.io/analysts-guide/writing-visualising/dashboards_rshiny.html#learning-r-shiny">Analysts’ Guide R Shiny guidance</a></p></li>
<li class="fragment"><p>For R packages look no further than <a href="https://r-pkgs.org/">R packages by Hadley Wickham and Jennifer Bryan</a></p></li>
</ul></li>
</ul>
</section>
<section id="if-you-want-to-get-more-confident-using-r" class="slide level2">
<h2>If you want to get more confident using R</h2>
<ul>
<li class="fragment"><p>See our <a href="https://dfe-analytical-services.github.io/analysts-guide/learning-development/learning-support.html#technical-workshops">unit’s R workshop</a> offer</p></li>
<li class="fragment"><p>OR some of the many, <a href="https://dfe-analytical-services.github.io/analysts-guide/learning-development/r.html">great free online resources for getting started with R</a></p></li>
<li class="fragment"><p>Remember, the best coders don’t have lots of unique knowledge, they’re just usually the most willing to search for the answers to problems themselves instead of relying on others, so get stuck in yourself and get curious!</p></li>
</ul>
</section>
<section id="basic-example-of-what-were-going-to-look-at" class="slide level2">
<h2>Basic example of what we’re going to look at</h2>
<p>Many of you who’ve written R code before will have come across something like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a>my_table <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="st">""</span>)</span>
<span id="cb1-2"><a href=""></a></span>
<span id="cb1-3"><a href=""></a><span class="cf">if</span>(<span class="fu">nrow</span>(my_table) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb1-4"><a href=""></a>  <span class="fu">stop</span>(<span class="st">"There are no rows in the table, this can't be right!"</span>)</span>
<span id="cb1-5"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>This is an example of pass / fail automated QA!</p></li>
<li class="fragment"><p>It checks for a condition and then if it meets a criteria it stops the code and tries to give a semi-informative error</p></li>
<li class="fragment"><p>I’m going to show how you can use testthat for this</p>
<ul>
<li class="fragment">and then how you can expand on QA in Shiny and R packages</li>
</ul></li>
</ul>
</section>
<section id="why-use-automated-pass-fail-checks-as-a-part-of-qa" class="slide level2">
<h2>Why use automated pass / fail checks as a part of QA?</h2>
<ul>
<li class="fragment"><p>They are incredibly…</p>
<ul>
<li class="fragment"><p>fast</p></li>
<li class="fragment"><p>reliable</p></li>
<li class="fragment"><p>easy to understand</p></li>
</ul></li>
<li class="fragment"><p>They are the best way to start including simple automated checks into your code and data with minimal extra time or overhead to your processes</p>
<div>
<div class="quarto-figure quarto-figure-center">
<figure>
<figcaption>Crafting and pun credit: Mark Pearson</figcaption>
<p><img data-src="img/qa-lity_street.png" style="width:25.0%"></p>
</figure>
</div>
</div></li>
</ul>
</section>
<section id="working-as-a-part-of-a-team" class="slide level2">
<h2>Working as a part of a team?</h2>
<ul>
<li class="fragment"><p>Adding in quick automated pass fail checks will</p>
<ul>
<li class="fragment"><p>Make it easier for everyone to run the same code reliably</p></li>
<li class="fragment"><p>Make it easier for everyone to understand what the code is supposed to be doing</p></li>
<li class="fragment"><p>Cut down the time when investigating issues</p></li>
<li class="fragment"><p>Gives assurance when reviewing each others code that you’re making the same assumptions</p></li>
<li class="fragment"><p>All because it clearly and simply documents and tests your assumptions</p></li>
</ul></li>
</ul>
</section>
<section id="working-as-a-part-of-a-team-1" class="slide level2">
<h2>Working as a part of a team?</h2>
<p>You can also use them to add in catches for steps that require manual intervention e.g.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>  <span class="co"># Check the above and flag discrepancies with master table</span></span>
<span id="cb2-2"><a href=""></a><span class="cf">if</span>(<span class="fu">length</span>(newPublications) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb2-3"><a href=""></a>  <span class="fu">warning</span>(</span>
<span id="cb2-4"><a href=""></a>    <span class="fu">message</span>(<span class="st">"-----------------------"</span>),</span>
<span id="cb2-5"><a href=""></a>    <span class="fu">message</span>(<span class="st">"WARNING: There are new publications on the EES find stats page that are not in the master table."</span>),</span>
<span id="cb2-6"><a href=""></a>    <span class="fu">message</span>(<span class="st">"-----------------------"</span>),</span>
<span id="cb2-7"><a href=""></a>    <span class="fu">message</span>(<span class="st">"The following publications are new:"</span>),</span>
<span id="cb2-8"><a href=""></a>    <span class="fu">print</span>(newPublications),</span>
<span id="cb2-9"><a href=""></a>    <span class="fu">message</span>(<span class="st">""</span>),</span>
<span id="cb2-10"><a href=""></a>    <span class="fu">message</span>(<span class="st">"Please update the master table in SQL using the updateMasterTable.R script in this repo."</span>),</span>
<span id="cb2-11"><a href=""></a>    <span class="fu">message</span>(<span class="st">""</span>),</span>
<span id="cb2-12"><a href=""></a>  )</span>
<span id="cb2-13"><a href=""></a>}</span>
<span id="cb2-14"><a href=""></a></span>
<span id="cb2-15"><a href=""></a><span class="cf">if</span>(<span class="fu">length</span>(newlyOnEES) <span class="sc">!=</span> <span class="dv">0</span>){</span>
<span id="cb2-16"><a href=""></a>  <span class="fu">warning</span>(</span>
<span id="cb2-17"><a href=""></a>    <span class="fu">message</span>(<span class="st">"---------------------"</span>),</span>
<span id="cb2-18"><a href=""></a>    <span class="fu">message</span>(<span class="st">"WARNING: A publication marked as unpublished in the master table is now published on EES."</span>),</span>
<span id="cb2-19"><a href=""></a>    <span class="fu">message</span>(<span class="st">"---------------------"</span>),</span>
<span id="cb2-20"><a href=""></a>    <span class="fu">message</span>(<span class="st">"The following publications are newly published to EES:"</span>),</span>
<span id="cb2-21"><a href=""></a>    <span class="fu">print</span>(newlyOnEES),</span>
<span id="cb2-22"><a href=""></a>    <span class="fu">message</span>(<span class="st">""</span>),</span>
<span id="cb2-23"><a href=""></a>    <span class="fu">message</span>(<span class="st">"Please update the rows for these publications in the master table using the updateMasterTable.R script in this repo."</span>),</span>
<span id="cb2-24"><a href=""></a>    <span class="fu">message</span>(<span class="st">""</span>),</span>
<span id="cb2-25"><a href=""></a>    <span class="fu">message</span>(<span class="st">"---------------------"</span>)</span>
<span id="cb2-26"><a href=""></a>  )</span>
<span id="cb2-27"><a href=""></a>}</span>
<span id="cb2-28"><a href=""></a></span>
<span id="cb2-29"><a href=""></a><span class="cf">if</span>(<span class="fu">length</span>(newPublications) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(newlyOnEES) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb2-30"><a href=""></a>  <span class="fu">message</span>(<span class="st">"-----------------------"</span>)</span>
<span id="cb2-31"><a href=""></a>  <span class="fu">message</span>(<span class="st">"PASS - Master table is up to date with the live service!"</span>)</span>
<span id="cb2-32"><a href=""></a>  <span class="fu">message</span>(<span class="st">"-----------------------"</span>)</span>
<span id="cb2-33"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="working-alone" class="slide level2">
<h2>Working alone?</h2>
<p>If you’re like me, and ol’ Frederick here, you might end up having conversations with yourself about the code…</p>

<!-- -->
<img data-src="img/frederick_taxi_driver.png" style="width:70.0%" alt="'You talkin’ to me? You talkin' to me? Well I'm the only one here. Who the duck do you think you're talking to?'" class="r-stretch quarto-figure-center"><p class="caption">‘You talkin’ to me? You talkin’ to me? Well I’m the only one here. Who the duck do you think you’re talking to?’ Frederick Bickles, 2024</p><ul>
<li class="fragment"><p>Adding in quick automated pass fail checks will</p>
<ul>
<li class="fragment"><p>Make it easier for you to run the same code reliably</p></li>
<li class="fragment"><p>Make it easier for you to remember what the code is supposed to be doing</p></li>
<li class="fragment"><p>Cut down the time when investigating issues</p></li>
<li class="fragment"><p>Give assurance when writing code that it and the outputs are being QA’d consistently</p></li>
</ul></li>
</ul>
</section>
<section id="packages-well-use" class="slide level2">
<h2>Packages we’ll use</h2>
<ul>
<li class="fragment"><p>For everyone</p>
<ul>
<li class="fragment"><a href="https://testthat.r-lib.org/">testthat</a></li>
</ul></li>
<li class="fragment"><p>For R Shiny developers</p>
<ul>
<li class="fragment"><a href="https://rstudio.github.io/shinytest2/">shinytest2</a> (Side note: Are you still using the original shinytest? Stop. Migrate to shinytest2 now.)</li>
</ul></li>
<li class="fragment"><p>For R package developers</p>
<ul>
<li class="fragment"><p><a href="https://usethis.r-lib.org/">usethis</a></p></li>
<li class="fragment"><p><a href="https://devtools.r-lib.org/">devtools</a></p></li>
</ul></li>
<li class="fragment"><p>Bonus level:</p>
<ul>
<li class="fragment"><a href="https://github.com/features/actions">GitHub Actions</a> (not a package, nor specifically for R, but something that is genuinely excellent and you should make use of if you can)</li>
</ul></li>
</ul>
</section>
<section id="a-whole-new-world" class="title-slide slide level1 center">
<h1>A whole new world…</h1>

<img data-src="img/frederick_r_magic_carpet.png" class="quarto-figure quarto-figure-center r-stretch" alt="A mediocre visual pun smushing R with Disney's Aladdin"></section>

<section>
<section id="testing-r-code-with-testthat" class="title-slide slide level1 center">
<h1>Testing R code with testthat</h1>

</section>
<section id="testing-principles" class="slide level2">
<h2>Testing principles</h2>
<div class="fragment">
<p>You should always think of automated tests as three phases</p>
<ol type="1">
<li class="fragment">GIVEN</li>
<li class="fragment">WHEN</li>
<li class="fragment">THEN</li>
</ol>
</div>
</section>
<section id="testing-principles-1" class="slide level2">
<h2>Testing principles</h2>
<ul>
<li class="fragment"><p>GIVEN</p>
<ul>
<li class="fragment">Two numbers</li>
</ul></li>
<li class="fragment"><p>WHEN</p>
<ul>
<li class="fragment">You run a function on those numbers to add them together</li>
</ul></li>
<li class="fragment"><p>THEN</p>
<ul>
<li class="fragment">You get the sum of those two numbers</li>
</ul></li>
</ul>
</section>
<section id="testing-principles---testthat-example" class="slide level2">
<h2>Testing principles - testthat example</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a><span class="fu">library</span>(testthat)</span>
<span id="cb3-2"><a href=""></a></span>
<span id="cb3-3"><a href=""></a><span class="co"># GIVEN</span></span>
<span id="cb3-4"><a href=""></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-5"><a href=""></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb3-6"><a href=""></a></span>
<span id="cb3-7"><a href=""></a><span class="co"># WHEN</span></span>
<span id="cb3-8"><a href=""></a>z <span class="ot">&lt;-</span> <span class="fu">sum</span>(x, y)</span>
<span id="cb3-9"><a href=""></a></span>
<span id="cb3-10"><a href=""></a><span class="co"># THEN</span></span>
<span id="cb3-11"><a href=""></a><span class="co"># Instead of an if statement we use the expect_* functions from testthat</span></span>
<span id="cb3-12"><a href=""></a><span class="fu">expect_equal</span>(z, <span class="dv">5</span>) </span>
<span id="cb3-13"><a href=""></a></span>
<span id="cb3-14"><a href=""></a><span class="co"># If this passes nothing happens, it doesn't print to the console, and the rest of your code will run as normal</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="testing-principles---tidied-example" class="slide level2">
<h2>Testing principles - tidied example</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="fu">library</span>(testthat)</span>
<span id="cb4-2"><a href=""></a></span>
<span id="cb4-3"><a href=""></a><span class="co"># GIVEN</span></span>
<span id="cb4-4"><a href=""></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb4-5"><a href=""></a>y <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb4-6"><a href=""></a></span>
<span id="cb4-7"><a href=""></a><span class="co"># WHEN &amp; THEN (often written this way for conciseness)</span></span>
<span id="cb4-8"><a href=""></a><span class="fu">expect_equal</span>(<span class="fu">sum</span>(x, y), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="what-if-it-fails" class="slide level2">
<h2>What if it fails?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a><span class="fu">library</span>(testthat)</span>
<span id="cb5-2"><a href=""></a></span>
<span id="cb5-3"><a href=""></a><span class="co"># GIVEN</span></span>
<span id="cb5-4"><a href=""></a>x <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb5-5"><a href=""></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="co"># uh-oh spaghetti-o</span></span>
<span id="cb5-6"><a href=""></a></span>
<span id="cb5-7"><a href=""></a><span class="co"># WHEN &amp; THEN</span></span>
<span id="cb5-8"><a href=""></a><span class="fu">expect_equal</span>(<span class="fu">sum</span>(x, y), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : sum(x, y) not equal to 5.
1/1 mismatches
[1] 4 - 5 == -1</code></pre>
</div>
</div>
<p>This throws an error and stops your code - this is particularly helpful if you have certain expectations that later code relies on, and allows you to fix the problem before it compounds and causes lots of later errors.</p>
</section>
<section id="example-data-you-can-use-yourself" class="slide level2">
<h2>Example data you can use yourself</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="fu">head</span>(dplyr<span class="sc">::</span>starwars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  name      height  mass hair_color skin_color eye_color birth_year sex   gender
  &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
1 Luke Sky…    172    77 blond      fair       blue            19   male  mascu…
2 C-3PO        167    75 &lt;NA&gt;       gold       yellow         112   none  mascu…
3 R2-D2         96    32 &lt;NA&gt;       white, bl… red             33   none  mascu…
4 Darth Va…    202   136 none       white      yellow          41.9 male  mascu…
5 Leia Org…    150    49 brown      light      brown           19   fema… femin…
6 Owen Lars    178   120 brown, gr… light      blue            52   male  mascu…
# ℹ 5 more variables: homeworld &lt;chr&gt;, species &lt;chr&gt;, films &lt;list&gt;,
#   vehicles &lt;list&gt;, starships &lt;list&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a><span class="co"># Could also do it this way</span></span>
<span id="cb9-2"><a href=""></a><span class="co">#</span></span>
<span id="cb9-3"><a href=""></a><span class="co"># library(dplyr)</span></span>
<span id="cb9-4"><a href=""></a><span class="co"># head(starwars)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="examples-on-star-wars-data" class="slide level2">
<h2>Examples on star wars data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href=""></a><span class="co"># Check that df_starwars is a data frame</span></span>
<span id="cb10-2"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_true</span>(dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> <span class="fu">is.data.frame</span>())</span>
<span id="cb10-3"><a href=""></a></span>
<span id="cb10-4"><a href=""></a><span class="co"># An alternative that I know will fail</span></span>
<span id="cb10-5"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_true</span>(dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> <span class="fu">is.vector</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : is.vector(dplyr::starwars) is not TRUE

`actual`:   FALSE
`expected`: TRUE </code></pre>
</div>
</div>
<ul>
<li class="fragment"><p>These kind of class / type checks are particularly useful for</p>
<ul>
<li class="fragment"><p>Catching issues early in processes to prevent compound errors</p></li>
<li class="fragment"><p>Quality checking output data</p></li>
</ul></li>
</ul>
</section>
<section id="examples-on-star-wars-data-1" class="slide level2">
<h2>Examples on star wars data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href=""></a><span class="co"># Check that the height column is numeric</span></span>
<span id="cb12-2"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_true</span>(dplyr<span class="sc">::</span>starwars<span class="sc">$</span>height <span class="sc">|&gt;</span> <span class="fu">is.numeric</span>())</span>
<span id="cb12-3"><a href=""></a></span>
<span id="cb12-4"><a href=""></a><span class="co"># An alternative that I know will fail</span></span>
<span id="cb12-5"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_true</span>(dplyr<span class="sc">::</span>starwars<span class="sc">$</span>height <span class="sc">|&gt;</span> <span class="fu">is.character</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : is.character(dplyr::starwars$height) is not TRUE

`actual`:   FALSE
`expected`: TRUE </code></pre>
</div>
</div>
</section>
<section id="examples-on-star-wars-data-2" class="slide level2">
<h2>Examples on star wars data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="co"># Check that no characters have a height over 500cm</span></span>
<span id="cb14-2"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_lt</span>(dplyr<span class="sc">::</span>starwars<span class="sc">$</span>height <span class="sc">|&gt;</span> <span class="fu">max</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="dv">500</span>)</span>
<span id="cb14-3"><a href=""></a></span>
<span id="cb14-4"><a href=""></a><span class="co"># An example I know will fail</span></span>
<span id="cb14-5"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_gt</span>(dplyr<span class="sc">::</span>starwars<span class="sc">$</span>height <span class="sc">|&gt;</span> <span class="fu">max</span>(<span class="at">na.rm=</span><span class="cn">TRUE</span>), <span class="dv">500</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : max(dplyr::starwars$height, na.rm = TRUE) is not strictly more than 500. Difference: -236</code></pre>
</div>
</div>
<ul>
<li class="fragment">Again, this kind of check can be easily applied to sense-check your data ranges, before, during and after processing</li>
</ul>
</section>
<section id="examples-on-star-wars-data-3" class="slide level2">
<h2>Examples on star wars data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="co"># Check that there are at least unique 50 characters</span></span>
<span id="cb16-2"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_gte</span>(</span>
<span id="cb16-3"><a href=""></a>  dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb16-4"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb16-5"><a href=""></a>    <span class="fu">nrow</span>(), </span>
<span id="cb16-6"><a href=""></a>  <span class="dv">50</span></span>
<span id="cb16-7"><a href=""></a>)</span>
<span id="cb16-8"><a href=""></a></span>
<span id="cb16-9"><a href=""></a><span class="co"># An example I know will fail</span></span>
<span id="cb16-10"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_lte</span>(</span>
<span id="cb16-11"><a href=""></a>  dplyr<span class="sc">::</span>starwars <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a href=""></a>    dplyr<span class="sc">::</span><span class="fu">distinct</span>(name) <span class="sc">|&gt;</span> </span>
<span id="cb16-13"><a href=""></a>    <span class="fu">nrow</span>(), </span>
<span id="cb16-14"><a href=""></a>  <span class="dv">50</span></span>
<span id="cb16-15"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : nrow(dplyr::distinct(dplyr::starwars, name)) is not less than 50. Difference: 37</code></pre>
</div>
</div>
<ul>
<li class="fragment">This could be particularly useful if you want to have a quick check to make sure you have the right number of LA’s and haven’t accidentally lost any in a join or aggregation</li>
</ul>
</section>
<section id="examples-on-star-wars-data-4" class="slide level2">
<h2>Examples on star wars data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href=""></a><span class="co"># Check that a common problematic rogue entry is there</span></span>
<span id="cb18-2"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_in</span>(</span>
<span id="cb18-3"><a href=""></a>  <span class="st">"Darth Vader"</span>,</span>
<span id="cb18-4"><a href=""></a>  dplyr<span class="sc">::</span>starwars<span class="sc">$</span>name</span>
<span id="cb18-5"><a href=""></a>)</span>
<span id="cb18-6"><a href=""></a></span>
<span id="cb18-7"><a href=""></a><span class="co"># Check that if all items in a vector are present</span></span>
<span id="cb18-8"><a href=""></a>testthat<span class="sc">::</span><span class="fu">expect_contains</span>(</span>
<span id="cb18-9"><a href=""></a>  dplyr<span class="sc">::</span>starwars<span class="sc">$</span>name, </span>
<span id="cb18-10"><a href=""></a>  <span class="fu">c</span>(<span class="st">"Professor Charles Xavier"</span>, <span class="st">"C-3PO"</span>, <span class="st">"R2-D2"</span>)</span>
<span id="cb18-11"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : dplyr::starwars$name (`actual`) doesn't fully contain all the values in c("Professor Charles Xavier", "C-3PO", "R2-D2") (`expected`).
* Missing from `actual`: "Professor Charles Xavier"
* Present in `actual`:   "Luke Skywalker", "C-3PO", "R2-D2", "Darth Vader", "Leia Organa", "Owen Lars", "Beru Whitesun Lars", "R5-D4", "Biggs Darklighter", ...</code></pre>
</div>
</div>
</section>
<section id="example-on-locations-data" class="slide level2">
<h2>Example on locations data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href=""></a><span class="fu">head</span>(dfeR<span class="sc">::</span>wd_pcon_lad_la_rgn_ctry)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  first_available_year_included most_recent_year_included
1                          2017                      2017
2                          2017                      2017
3                          2017                      2020
4                          2017                      2017
5                          2017                      2020
6                          2017                      2017
               ward_name  pcon_name              lad_name               la_name
1               Bastwell  Blackburn Blackburn with Darwen Blackburn with Darwen
2                Ormesby     Redcar  Redcar and Cleveland  Redcar and Cleveland
3            Burn Valley Hartlepool            Hartlepool            Hartlepool
4 Beardwood with Lammack  Blackburn Blackburn with Darwen Blackburn with Darwen
5               De Bruce Hartlepool            Hartlepool            Hartlepool
6           St Germain's     Redcar  Redcar and Cleveland  Redcar and Cleveland
  region_name country_name ward_code pcon_code  lad_code new_la_code
1  North West      England E05001621 E14000570 E06000008   E06000008
2  North East      England E05001518 E14000891 E06000003   E06000003
3  North East      England E05008942 E14000733 E06000001   E06000001
4  North West      England E05001622 E14000570 E06000008   E06000008
5  North East      England E05008943 E14000733 E06000001   E06000001
6  North East      England E05001519 E14000891 E06000003   E06000003
  region_code country_code
1   E12000002    E92000001
2   E12000001    E92000001
3   E12000001    E92000001
4   E12000002    E92000001
5   E12000001    E92000001
6   E12000001    E92000001</code></pre>
</div>
</div>
</section>
<section id="example-on-locations-data-1" class="slide level2">
<h2>Example on locations data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href=""></a>lookup <span class="ot">&lt;-</span> dfeR<span class="sc">::</span>wd_pcon_lad_la_rgn_ctry</span>
<span id="cb22-2"><a href=""></a></span>
<span id="cb22-3"><a href=""></a><span class="co"># Check that the lookup file contains all LAs in England in 2024</span></span>
<span id="cb22-4"><a href=""></a><span class="fu">expect_contains</span>(</span>
<span id="cb22-5"><a href=""></a>  lookup<span class="sc">$</span>la_name,</span>
<span id="cb22-6"><a href=""></a>  dfeR<span class="sc">::</span><span class="fu">fetch_las</span>(<span class="at">year =</span> <span class="dv">2024</span>, <span class="at">countries =</span> <span class="st">"England"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href=""></a>    <span class="fu">pull</span>(la_name)</span>
<span id="cb22-8"><a href=""></a>)</span>
<span id="cb22-9"><a href=""></a></span>
<span id="cb22-10"><a href=""></a><span class="co"># Example of it failing</span></span>
<span id="cb22-11"><a href=""></a><span class="fu">expect_contains</span>(</span>
<span id="cb22-12"><a href=""></a>  lookup<span class="sc">$</span>la_name,</span>
<span id="cb22-13"><a href=""></a>  <span class="st">"Westeros"</span></span>
<span id="cb22-14"><a href=""></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Error : lookup$la_name (`actual`) doesn't fully contain all the values in "Westeros" (`expected`).
* Missing from `actual`: "Westeros"
* Present in `actual`:   "Blackburn with Darwen", "Redcar and Cleveland", "Hartlepool", "Blackburn with Darwen", "Hartlepool", "Redcar and Cleveland", "Blackburn with Darwen", "Hartlepool", "Redcar and Cleveland", ...</code></pre>
</div>
</div>
<ul>
<li class="fragment"><p>An example where this might be helpful is when doing analysis across boundary changes, and you’ve had a specific issue with a rogue location not appearing in your latest year of data when it should be there</p></li>
<li class="fragment"><p>It’s quick and easy to add specific checks to give you and others relying on your analysis peace of mind that those issues can’t be repeated!</p></li>
</ul>
</section>
<section id="most-common-expect_-functions" class="slide level2">
<h2>Most common expect_* functions</h2>
<ul>
<li class="fragment"><p>expect_equal() / expect_identical()</p></li>
<li class="fragment"><p>expect_true() / expect_false()</p></li>
<li class="fragment"><p>expect_lt() / expect_lte() / expect_gt / expect_gte()</p></li>
<li class="fragment"><p>expect_contains() / expect_in()</p></li>
<li class="fragment"><p>expect_error() / expect_warning() / expect_message()</p></li>
<li class="fragment"><p>expect_no_error() / expect_no_warning() / expect_no_message()</p></li>
<li class="fragment"><p>You can even build <a href="https://testthat.r-lib.org/articles/custom-expectation.html">custom expectations</a></p></li>
<li class="fragment"><p>Full list and documentation on the <a href="https://testthat.r-lib.org/reference/index.html">testthat site</a></p></li>
</ul>
</section>
<section id="when-and-where-should-i-do-this" class="slide level2">
<h2>When and where should I do this?</h2>
<p>Really you could be doing this before, during, and after your analysis code! For example, you might already do this kind of thing in SQL scripts</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb24-1"><a href=""></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> my_table</span>
<span id="cb24-2"><a href=""></a></span>
<span id="cb24-3"><a href=""></a><span class="co">-- 1,551 rows</span></span>
<span id="cb24-4"><a href=""></a></span>
<span id="cb24-5"><a href=""></a><span class="kw">SELECT</span> <span class="kw">DISTINCT</span> (la_name) <span class="kw">FROM</span> my_table</span>
<span id="cb24-6"><a href=""></a></span>
<span id="cb24-7"><a href=""></a><span class="co">-- 153 rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li class="fragment">This is how you should think of these checks, a way of regularly documenting your assumptions through the code!</li>
</ul>
</section>
<section id="when-and-where-should-i-do-this-1" class="slide level2">
<h2>When and where should I do this?</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode numberSource r R number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href=""></a><span class="fu">library</span>(dplyr)</span>
<span id="cb25-2"><a href=""></a><span class="fu">library</span>(testthat)</span>
<span id="cb25-3"><a href=""></a></span>
<span id="cb25-4"><a href=""></a><span class="co"># Import data</span></span>
<span id="cb25-5"><a href=""></a>raw_data <span class="ot">&lt;-</span> starwars</span>
<span id="cb25-6"><a href=""></a></span>
<span id="cb25-7"><a href=""></a><span class="co"># Check raw data has at least 50 rows</span></span>
<span id="cb25-8"><a href=""></a><span class="fu">expect_gte</span>(<span class="fu">nrow</span>(raw_data), <span class="dv">50</span>)</span>
<span id="cb25-9"><a href=""></a></span>
<span id="cb25-10"><a href=""></a><span class="co"># Process data to aggregate by species</span></span>
<span id="cb25-11"><a href=""></a>species_summary <span class="ot">&lt;-</span> raw_data <span class="sc">|&gt;</span> </span>
<span id="cb25-12"><a href=""></a>  <span class="fu">group_by</span>(species) <span class="sc">|&gt;</span> </span>
<span id="cb25-13"><a href=""></a>  <span class="fu">summarise</span>(</span>
<span id="cb25-14"><a href=""></a>    <span class="at">avg_height =</span> <span class="fu">mean</span>(height, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-15"><a href=""></a>    <span class="at">avg_mass =</span> <span class="fu">mean</span>(mass, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb25-16"><a href=""></a>  )</span>
<span id="cb25-17"><a href=""></a></span>
<span id="cb25-18"><a href=""></a><span class="co"># Check the processing</span></span>
<span id="cb25-19"><a href=""></a><span class="fu">expect_equal</span>(<span class="fu">ncol</span>(species_summary), <span class="dv">3</span>)</span>
<span id="cb25-20"><a href=""></a><span class="fu">expect_equal</span>(</span>
<span id="cb25-21"><a href=""></a>  <span class="fu">nrow</span>(species_summary),</span>
<span id="cb25-22"><a href=""></a>  raw_data<span class="sc">$</span>species <span class="sc">|&gt;</span> </span>
<span id="cb25-23"><a href=""></a>    <span class="fu">unique</span>() <span class="sc">|&gt;</span> </span>
<span id="cb25-24"><a href=""></a>    <span class="fu">length</span>()</span>
<span id="cb25-25"><a href=""></a>)</span>
<span id="cb25-26"><a href=""></a></span>
<span id="cb25-27"><a href=""></a><span class="co"># Imagine the final output is the summary table</span></span>
<span id="cb25-28"><a href=""></a><span class="co"># Sense check the output data</span></span>
<span id="cb25-29"><a href=""></a><span class="fu">expect_true</span>(species_summary<span class="sc">$</span>avg_mass <span class="sc">|&gt;</span> <span class="fu">is.numeric</span>())</span>
<span id="cb25-30"><a href=""></a><span class="fu">expect_true</span>(<span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.nan</span>(species_summary<span class="sc">$</span>avg_mass)))</span>
<span id="cb25-31"><a href=""></a><span class="fu">expect_gte</span>(species_summary<span class="sc">$</span>avg_mass <span class="sc">|&gt;</span> <span class="fu">min</span>(), <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="when-and-where-should-i-do-this-2" class="slide level2">
<h2>When and where should I do this?</h2>
<p>For more examples of code using this have a look at:</p>
<ul>
<li class="fragment"><p><a href="https://educationgovuk.sharepoint.com/:f:/r/sites/lvewp00086/SSU%20%20open%20sharing/Reproducible%20Analytical%20Pipeline%20(RAP)%20resources/Knowledge-share%20series?csf=1&amp;web=1&amp;e=S76Ld6">RAP knowledge share on QA</a> had a few good examples of this</p></li>
<li class="fragment"><p><a href="https://web.microsoftstream.com/video/6806b4ba-7b13-4c3c-96f1-9b91c0f1d85b">Coffee and coding on testing R code</a> (Rachel Tadd - 2020)</p></li>
</ul>
</section></section>
<section>
<section id="testing-r-shiny-applications" class="title-slide slide level1 center">
<h1>Testing R Shiny applications</h1>

</section>
<section id="different-r-shiny-tests" class="slide level2">
<h2>Different R Shiny tests</h2>
<p>Testing an application is different to dotting expectations through your code, you’ll often have a ‘suite’ or ‘suites’ of tests that you run periodically in bulk to quickly check the latest version of the code still does all the things it used to.</p>
<p>Test types are:</p>
<ol type="1">
<li class="fragment">Unit tests
<ul>
<li class="fragment"><p>Low level</p></li>
<li class="fragment"><p>Check the behaviour of specific functions</p></li>
<li class="fragment"><p>testthat is ideal for this</p></li>
<li class="fragment"><p>Very quick to create and to run</p></li>
</ul></li>
<li class="fragment">Integration tests
<ul>
<li class="fragment"><p>Medium level, integrating a number of moving parts</p></li>
<li class="fragment"><p>Shiny has testServer() built in already</p></li>
<li class="fragment"><p>Pretty quick to run, bit more effort to set up</p></li>
</ul></li>
<li class="fragment">UI (User Interface) or ‘End to end’ tests
<ul>
<li class="fragment"><p>Full test of the user experience and all components</p></li>
<li class="fragment"><p>shinytest2 gives you the full end to end tests (also known as UI tests)</p></li>
<li class="fragment"><p>Take longer to run, and a lot more effort to set up</p></li>
</ul></li>
</ol>
</section>
<section id="different-forms-of-tests" class="slide level2">
<h2>Different forms of tests</h2>

<img data-src="img/testing-pyramid.webp" class="r-stretch"></section>
<section id="running-the-tests" class="slide level2">
<h2>Running the tests</h2>
<ul>
<li class="fragment"><p>In an R Shiny application you’ll usually have a tests/ folder that contains all of your test scripts</p></li>
<li class="fragment"><p>Assuming you have shinytest2 installed, you can automatically run all of the above types of tests together using <code>shinytest2::test_app()</code></p></li>
<li class="fragment"><p>Our <a href="https://github.com/dfe-analytical-services/shiny-template">DfE shiny template</a> has examples of this - demo</p></li>
</ul>
</section></section>
<section>
<section id="bonus-continuous-integration-ci" class="title-slide slide level1 center">
<h1>Bonus: Continuous integration (CI)</h1>

</section>
<section id="bonus-continuous-integration-ci-1" class="slide level2">
<h2>Bonus: Continuous integration (CI)</h2>
<ul>
<li class="fragment"><p>Who doesn’t love bonus content? This is here as a bonus as it actually applies to multiple types of projects, not just R Shiny applications.</p></li>
<li class="fragment"><p>Continuous integration is</p>
<ul>
<li class="fragment"><p>the practice of integrating code changes frequently and ensuring that the integrated codebase is in a workable state</p></li>
<li class="fragment"><p>For our purposes, this means that every time we make a new version of the code, tests are run automatically against that code, speeding up the process!</p></li>
</ul></li>
<li class="fragment"><p>If your code is open and hosted in GitHub (i.e.&nbsp;is safe to share publicly), then you get GitHub Actions for free, and it’s incredibly powerful</p>
<ul>
<li class="fragment"><p>Free access to virtual machines that will run and test your code for you</p></li>
<li class="fragment"><p>A free way to automate code scripts on Git events (commits / pushes / PRs) or on a scheduled job (e.g.&nbsp;once everyday at midnight)</p></li>
<li class="fragment"><p>Integrate your tests with version control processes, so you have a clear audit trail and can proactively prevent issues from getting to your live application</p></li>
</ul></li>
<li class="fragment"><p>This is particularly useful where you have specific test folders or scripts that you want to run periodically against a ‘product’ but not inline in the actual code, e.g.&nbsp;R Shiny applications, R packages, deployed R models etc</p></li>
</ul>
</section>
<section id="example-of-ci" class="slide level2">
<h2>Example of CI</h2>
<p>For an example Shiny app that runs continuous integration, have a look at the <a href="https://github.com/dfe-analytical-services/dfe-published-data-qa">explore education statistics data screener on GitHub</a>.</p>
</section></section>
<section>
<section id="testing-r-packages" class="title-slide slide level1 center">
<h1>Testing R packages</h1>

</section>
<section id="what-is-an-r-package" class="slide level2">
<h2>What is an R package</h2>
<p>Every R user will have used some R packages at some point. For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href=""></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment"><p>This loads all of the functions that are premade in dplyr, ready into your R session for you to use!</p></li>
<li class="fragment"><p>It’s similar conceptually to having a <code>functions.R</code> script in your project and then running <code>source("functions.R")</code> so you can make use of the functions!</p></li>
</ul>
</section>
<section id="what-does-a-package-actually-look-like" class="slide level2">
<h2>What does a package actually look like?</h2>
<p>Think of it as being able to reuse others functions and having documentation on how they work</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href=""></a><span class="fu">library</span>(dfeR)</span>
<span id="cb27-2"><a href=""></a></span>
<span id="cb27-3"><a href=""></a><span class="fu">comma_sep</span>(<span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "3,000"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href=""></a>comma_sep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function(number,
                      nsmall = 0L) {
  format(number,
    big.mark = ",", nsmall = nsmall, trim = TRUE,
    scientific = FALSE
  )
}
&lt;bytecode: 0x000001c3f1675f80&gt;
&lt;environment: namespace:dfeR&gt;</code></pre>
</div>
</div>
</section>
<section id="what-does-code-in-a-package-actually-look-like" class="slide level2">
<h2>What does code in a package actually look like?</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href=""></a><span class="co">#' Comma separate</span></span>
<span id="cb31-2"><a href=""></a><span class="co">#'</span></span>
<span id="cb31-3"><a href=""></a><span class="co">#' @description</span></span>
<span id="cb31-4"><a href=""></a><span class="co">#' Adds separating commas to big numbers. If a value is not numeric it will</span></span>
<span id="cb31-5"><a href=""></a><span class="co">#' return the value unchanged and as a string.</span></span>
<span id="cb31-6"><a href=""></a><span class="co">#'</span></span>
<span id="cb31-7"><a href=""></a><span class="co">#' @param number number to be comma separated</span></span>
<span id="cb31-8"><a href=""></a><span class="co">#' @param nsmall minimum number of digits to the right of the decimal point</span></span>
<span id="cb31-9"><a href=""></a><span class="co">#'</span></span>
<span id="cb31-10"><a href=""></a><span class="co">#' @return string</span></span>
<span id="cb31-11"><a href=""></a><span class="co">#' @export</span></span>
<span id="cb31-12"><a href=""></a><span class="co">#'</span></span>
<span id="cb31-13"><a href=""></a><span class="co">#' @examples</span></span>
<span id="cb31-14"><a href=""></a><span class="co">#' comma_sep(100)</span></span>
<span id="cb31-15"><a href=""></a><span class="co">#' comma_sep(1000)</span></span>
<span id="cb31-16"><a href=""></a><span class="co">#' comma_sep(3567000)</span></span>
<span id="cb31-17"><a href=""></a>comma_sep <span class="ot">&lt;-</span> <span class="cf">function</span>(number,</span>
<span id="cb31-18"><a href=""></a>                      <span class="at">nsmall =</span> <span class="dv">0</span>L) {</span>
<span id="cb31-19"><a href=""></a>  <span class="fu">format</span>(number,</span>
<span id="cb31-20"><a href=""></a>    <span class="at">big.mark =</span> <span class="st">","</span>, <span class="at">nsmall =</span> nsmall, <span class="at">trim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb31-21"><a href=""></a>    <span class="at">scientific =</span> <span class="cn">FALSE</span></span>
<span id="cb31-22"><a href=""></a>  )</span>
<span id="cb31-23"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The documentation (<a href="https://roxygen2.r-lib.org/">roxygen2</a>) and easy automation built around R packages using <a href="https://devtools.r-lib.org/">devtools</a> and <a href="https://usethis.r-lib.org/">usethis</a> is a great reason why structuring code as an R package can be helpful even just for pipelines within teams</p>
<ul>
<li class="fragment">See the <a href="https://educationgovuk.sharepoint.com/:v:/r/sites/lvewp00086/SSU%20%20open%20sharing/Reproducible%20Analytical%20Pipeline%20(RAP)%20resources/Knowledge-share%20series/Knowledge%20share%207%20-%20RAP%20projects%20OUTSIDE%20of%20statistics%20production!.mp4?csf=1&amp;web=1&amp;e=yO4Maq">RAP knowledge share 7 ‘Beyond statistics’</a>, Matt Jago talks through his team’s move from Excel to using an R package for their pipeline</li>
</ul>
</section>
<section id="package-tests-examples" class="slide level2">
<h2>Package tests examples</h2>
<p>Most commonly in an R package you have unit tests against your functions so that you can ensure they reliably behave as expected for users of the package.</p>
<p>Example - <a href="https://github.com/dfe-analytical-services/dfeR/tree/main/tests">dfeR tests folder</a></p>
<p>Example - <a href="https://github.com/dfe-analytical-services/dfeshiny/tree/main/tests">dfeshiny tests folder</a></p>
</section></section>
<section>
<section id="wrap-up" class="title-slide slide level1 center">
<h1>Wrap up</h1>

</section>
<section id="additional-tips" class="slide level2">
<h2>Additional tips</h2>
<ol type="1">
<li class="fragment">Whenever you hit an issue, add a quick testthat test for it!
<ul>
<li class="fragment"><p>It’s a great way to prevent issues repeating themselves</p></li>
<li class="fragment"><p>Also allows you to slowly and steadily build up a set of checks that cover things you know could go wrong!</p></li>
</ul></li>
<li class="fragment">Start small
<ul>
<li class="fragment"><p>Don’t feel like you need to write all of the tests immediately - it’s a great way to lose lots of time in rabbit holes</p></li>
<li class="fragment"><p>Fewer, reliable tests that check a small amount of things well, are more valuable than a whopping suite of complicated and temperamental checks that check lots of things but add on lots of overhead</p></li>
</ul></li>
<li class="fragment">Don’t feel like you need to re-test other packages functions
<ul>
<li class="fragment"><p>that’s overkill, most packages already test their functions, so you can (mostly) trust them</p></li>
<li class="fragment"><p>however, it can be wise to do some research on the quality of the packages you’re using…</p>
<ul>
<li class="fragment"><p>has it been updated recently?</p></li>
<li class="fragment"><p>is it deployed on CRAN?</p></li>
<li class="fragment"><p>does it have good test coverage?</p></li>
<li class="fragment"><p>if in doubt get in touch with us and we can take a look (explore.statistics@education.gov.uk)</p></li>
</ul></li>
</ul></li>
</ol>
</section>
<section id="remember" class="slide level2">
<h2>Remember</h2>
<ol type="1">
<li class="fragment">GIVEN - WHEN - THEN</li>
<li class="fragment">Pass / fail tests are super quick to add
<ul>
<li class="fragment"><p>fast, reliable feedback on your code</p></li>
<li class="fragment"><p>help to speed up development by catching issues early</p></li>
<li class="fragment"><p>help to document expectations through your code</p></li>
</ul></li>
<li class="fragment">Pass / fail tests will never replace all QA</li>
<li class="fragment">If you can think of it, you can probably code it, get coding!</li>
</ol>
</section>
<section id="any-questions" class="slide level2">
<h2>Any questions?</h2>
<p>cameron.race@education.gov.uk</p>
<p>Slides made with Quarto:</p>
<div>
<ul>
<li><p><a href="https://github.com/dfe-analytical-services/pass-fail-qa-cc-20241120">GitHub repository</a></p></li>
<li><p><a href="https://dfe-analytical-services.github.io/pass-fail-qa-cc-20241120/">Slides themselves (deployed to GitHub pages)</a></p></li>
<li><p><a href="https://quarto.org/docs/presentations/">Get started on your own Quarto slides</a></p></li>
</ul>
</div>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p>Automated pass / fail QA in R, November 2024</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>